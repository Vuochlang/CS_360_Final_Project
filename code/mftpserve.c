#include "mftp.h"int portNumber = 49999;void createSever();bool isNumber(const char argv[]) {     	for (int i = 0; i < strlen(argv); i++) {        if (!isdigit(argv[i]))            return false;    }    return true;}int main(int argc, char const *argv[]) {    if (argc == 1) {        createSever();    }    else if (argc == 3 && strcmp("-p", argv[1]) == 0 && isNumber(argv[2])) {        portNumber = atoi(argv[2]);        createSever();    }    else {        printf("Error: ./mftpserve <OR> ./mftpserve -p PORT_NUMBER\n");        return 0;    }    return 0;}void createSever() {    printf("port number = %d\n", portNumber);    int socketFd, listenFd;    struct sockaddr_in servAddr;    int length = sizeof(struct sockaddr_in);    struct sockaddr_in clientAddr;    // make a socket    socketFd = socket(AF_INET, SOCK_STREAM, 0);    if (socketFd < 0) {        fprintf(stderr, "Error: %s\n", strerror(errno));        exit(1);    }    if (setsockopt(socketFd, SOL_SOCKET, SO_REUSEADDR, &(int){1}, sizeof(int)) < 0) {        fprintf(stderr, "Error: %s\n", strerror(errno));        exit(1);    }    // Bind the socket to a port    memset(&servAddr, 0, sizeof(servAddr));    servAddr.sin_family = AF_INET;    servAddr.sin_port = htons(portNumber);    servAddr.sin_addr.s_addr = htonl(INADDR_ANY);    if (bind(socketFd, (struct sockaddr *) &servAddr, sizeof(servAddr)) < 0) {        fprintf(stderr, "Error: %s\n", strerror(errno));        exit(1);    }    // Listen and Accept connections    if (listen(socketFd, 1) < 0) {        fprintf(stderr, "Error: %s\n", strerror(errno));        exit(1);    }    char messageRead[20], buffer[20];    int connectCounter = 0;    char temp[2];    char clientName[100] = "";    if ((listenFd = accept(socketFd, (struct sockaddr *) &clientAddr, &length)) < 0) {        fprintf(stderr, "Error: %s\n", strerror(errno));        exit(1);    }    char hostName[120];    int hostEntry;    time_t myTime;    char *timeStr;    hostEntry = getnameinfo((struct sockaddr*)&clientAddr,            sizeof(clientAddr),            hostName,            sizeof(hostName),            NULL,            0,            NI_NUMERICSERV);    if (hostEntry != 0) {        fprintf(stderr, "Error: %s\n", gai_strerror(hostEntry));    }    time(&myTime);    timeStr = ctime(&myTime);    printf("\n--- Got a connection from %s at %s", hostName, timeStr);    bool isExit = false;    int max = 200;    if (fork() == 0) {        close(socketFd);        char command[max];        int readResult = 0;        char connected[] = "FROM SERVER: connected to Server at ";        strcat(connected, timeStr);        write(listenFd, connected, strlen(connected));        bzero(command, max);        while((readResult = read(listenFd, command, max)) > 0){            char temp[] = "FROM CLIENT: ";            strcat(temp, command);            write(1, temp, strlen(temp));            if (strcmp("Q", command) == 0) {                printf("\nExiting...Goodbye\n");                char disconnect[] = "FROM SERVER: received exit command, exiting...\n";                write(listenFd, disconnect, strlen(disconnect));                close(listenFd);                exit(0);            }            char temp2[] = "TO CLIENT: ";            strcat(temp2, command);            strcat(temp2, "\n");            write(1, temp2, strlen(temp2));            char send[] = "FROM SERVER: ";            strcat(send, command);            strcat(send, "\n");            write(listenFd, send, strlen(send));            bzero(command, max);        }//            while (!isExit) {//                readResult = read(listenFd, command, strlen(command));//                while (readResult <= 0) {//                    if (readResult < 0) {//                        fprintf(stderr, "Error: %s\n", strerror(errno));//                    }//                    readResult = read(listenFd, command, strlen(command));//                }//                assert(readResult > 0);//                printf("got sth %d %s\n", readResult, command);////                if (strcmp("Q", command) == 0) {//                    printf("server recieved exit...\n");//                    isExit = true;//                    break;//                }//                else {//                    printf("server recieved %s\n", command);//                    char note[] = "Server sent ";//                    strcat(note, command);//                    strcat(note, "\n");//                    write(listenFd, note, strlen(note));//                }//            }    }    close(listenFd);    wait(0);    return;}